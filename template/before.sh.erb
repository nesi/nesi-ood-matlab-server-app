# This script (`before.sh.erb`) is sourced directly into the main Bash script
# that is run when the batch job starts up. It is called before the `script.sh`
# is forked off into a separate process.
# Export the module function if it exists
[[ $(type -t module) == "function" ]] && export -f module

exec &> >(tee -a "pod.log")

source /bin/find_host_port
source /bin/save_passwd_as_secret

export MWI_AUTH_TOKEN=$PASSWORD
export password=$PASSWORD

export MWI_APP_PORT=8080
export MWI_APP_HOST=0.0.0.0
export MWI_PROCESS_START_TIMEOUT=900

export host="$HOST_CFG"
export port="$PORT_CFG"

echo "host is: ${host}"
echo "port is: ${port}"
echo "password is: ${password}"
echo "MWI_AUTH_TOKEN is: ${MWI_AUTH_TOKEN}"
echo "MWI_BASE_URL is: ${MWI_BASE_URL}"
